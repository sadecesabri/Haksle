(function(){var myWindow=arguments[0];var $=myWindow.$;var settings={level:[],filter:{},basketctr:{},piecesctr:{},picturesctr:undefined,pricesctr:undefined,addtobasketctr:undefined,business:{},supplyinfoctr:{},maxprodqtyctr:{},defaultPropertyValueID:0,isLightBox:0};$.fn.extendOptions=function(options){$.extend(settings,options);};$.fn.prodetailFilterForKombin=function(productOptions,productOptionsData,productStockData){var $this=$(this);var productId=$(this).attr("data-product-id");function multiProductBasketContext(){var newBasketProducts=[];this.NewBasketProducts=newBasketProducts;function updateProduct(basketProductId,basketProductQuantity){if(basketProductId!=0){for(var index=0;index<newBasketProducts.length;index++){if(newBasketProducts[index].productId==basketProductId){if(basketProductQuantity==0){removeProductAtIndex(index);}else{newBasketProducts[index].quantity=basketProductQuantity;}return true;}}if(basketProductQuantity!=0){newBasketProducts.push({productId:basketProductId,quantity:basketProductQuantity});return true;}}return false;}this.UpdateProduct=updateProduct;function removeProductAtIndex(index){newBasketProducts.splice(index,1);}}if(!myWindow.multiProductBasketContext){myWindow.multiProductBasketContext=new multiProductBasketContext();}var createSelect=function(optionsDivId,selectOptionList,selectType){if(selectType==="color"){var selectDivId="select-color";var selectCssClass="product-color-select";var selectId="product-color-options-select";var selectName="Renk";var selectDefaultOptionText="Renk Seçenekleri";}$("#"+optionsDivId,$this).append("<div id='"+selectDivId+"' class='optbox'><select class='"+selectCssClass+"' id='"+selectId+"' name='"+selectName+"'>");var selectlist=$this.find("#"+selectId);$(selectlist).append("<option value='-1'>"+selectDefaultOptionText+"</option>");for(var optionIndex=0;optionIndex<selectOptionList.length;optionIndex++){$(selectlist).append("<option value='"+selectOptionList[optionIndex].id+"' data-product-color-id='"+selectOptionList[optionIndex].pid+"'>"+selectOptionList[optionIndex].n+"</option>");}$("#"+optionsDivId,$this).append("</div>");selectlist.on("change",function(){if(productOptionsData.sizeOptionList){createSizeOptions($(this));}});};var createSizeOptions=function(colorSelectList){if($("#"+productOptions.sizeOptions.optionsChoiceDiv+" div.selected",$this).length>0){$("#"+productOptions.sizeOptions.optionsChoiceDiv+" div.selected",$this).each(function(){myWindow.multiProductBasketContext.UpdateProduct($(this).attr("data-product-size-id"),0);$(this).removeClass("selected");});}$("#"+productOptions.sizeOptions.optionsChoiceDiv,$this).empty();if(colorSelectList==null||colorSelectList.val()==-1){$("#"+productOptions.sizeOptions.optionsDiv,$this).hide();return;}else{$("#"+productOptions.sizeOptions.optionsDiv,$this).show();}var selectedColorId=colorSelectList.val();var divClass="";var sizeOptionName="";if(productOptionsData.sizeOptionList.length==1){if(productStockData[selectedColorId]&&productStockData[selectedColorId][productOptionsData.sizeOptionList[0].id]&&productStockData[selectedColorId][productOptionsData.sizeOptionList[0].id].qnt>0){divClass="sizeOption";sizeOptionName=productOptionsData.sizeOptionList[0].n;if(sizeOptionName.length>=5){divClass+=" w35";}divClass+=" selected";$("#"+productOptions.sizeOptions.optionsChoiceDiv,$this).append("<div class='"+divClass+"' data-product-size-id='"+$(":selected",colorSelectList).attr("data-product-color-id")+"'>"+sizeOptionName+"</div>");myWindow.multiProductBasketContext.UpdateProduct($(":selected",colorSelectList).attr("data-product-color-id"),$this.find("#"+productOptions.quantityOptions.quantitySelect).val());$("#"+productOptions.sizeOptions.optionsDiv,$this).hide();}}else{for(var optionIndex=0;optionIndex<productOptionsData.sizeOptionList.length;optionIndex++){if(productStockData[selectedColorId]&&productStockData[selectedColorId][productOptionsData.sizeOptionList[optionIndex].id]&&productStockData[selectedColorId][productOptionsData.sizeOptionList[optionIndex].id].qnt>0){divClass="sizeOption";sizeOptionName=productOptionsData.sizeOptionList[optionIndex].n;if(sizeOptionName.length>=5){divClass+=" w35";}$("#"+productOptions.sizeOptions.optionsChoiceDiv,$this).append("<div class='"+divClass+"' data-product-size-id='"+productOptionsData.sizeOptionList[optionIndex].pid+"'>"+sizeOptionName+"</div>");}}}if($("#"+productOptions.sizeOptions.optionsChoiceDiv+" div.sizeOption",$this).length>0){$("#"+productOptions.sizeOptions.optionsChoiceDiv+" div.sizeOption",$this).on("click",function(){if($(this).hasClass("selected")){myWindow.multiProductBasketContext.UpdateProduct($(this).attr("data-product-size-id"),0);$(this).parent().find("div").removeClass("selected");}else{if($(this).parent().find("div.selected").length>0){$(this).parent().find("div.selected").each(function(){var divObj=$(this);myWindow.multiProductBasketContext.UpdateProduct(divObj.attr("data-product-size-id"),0);});}myWindow.multiProductBasketContext.UpdateProduct($(this).attr("data-product-size-id"),$this.find("#"+productOptions.quantityOptions.quantitySelect).val());$(this).parent().find("div").removeClass("selected");$(this).addClass("selected");}});}else{$("#"+productOptions.sizeOptions.optionsChoiceDiv,$this).append("<span class=''>Bu ürün tükenmiştir.</span>");}};if(productOptionsData.colorOptionList){createSelect(productOptions.colorOptions.optionsChoiceDiv,productOptionsData.colorOptionList,"color");}else{$("#"+productOptions.colorOptions.optionsDiv,$this).hide();}if(productOptionsData.sizeOptionList){createSizeOptions();}else{$("#"+productOptions.sizeOptions.optionsDiv,$this).hide();}$this.find("#"+productOptions.quantityOptions.quantitySelect).on("change",function(){var selectedQuantity=$(this).val();if($this.find("#"+productOptions.sizeOptions.optionsChoiceDiv+" div.selected").length>0){$this.find("#"+productOptions.sizeOptions.optionsChoiceDiv+" div.selected").each(function(){var divObj=$(this);myWindow.multiProductBasketContext.UpdateProduct(divObj.attr("data-product-size-id"),selectedQuantity);});}});};$.fn.ProdetailFilter=function(options){if(options){$.extend(settings,options);}var $this=$(this);var selected=[];var levelcount=settings.level.length;$(settings.basketctr).addClass("disabled");var basketContext={productID:0,quantity:0,validate:function(){myWindow.basketContext.quantity=settings.piecesctr.val()*1;if(!myWindow.basketContext.productID){var i=1;var count=settings.level.length;for(i;i<count;i++){if(!selected[i]){settings.business.alert("Lütfen "+(settings.level[i].n).toLowerCase()+" seçiniz !");break;}}return false;}if(!myWindow.basketContext.quantity){settings.business.alert("Lütfen adet seçiniz!");return false;}return true;}};myWindow.basketContext=basketContext;var init=function(){basketContext.sizeID=0;basketContext.productID=0;basketContext.quantity=0;if(settings.defaultPropertyValueID){selected[1]=settings.defaultPropertyValueID;}updateList();};var selectProduct=function(){var sel;var i=1;for(i;i<levelcount;i++){var selV=selected[i];if(!selV){myWindow.basketContext.productID=0;return;}if(!sel){sel=settings.filter[selV];}else{sel=sel[selV];}}if(sel){myWindow.basketContext.productID=sel.id;if(sel.sdt){$(settings.supplyinfoctr).html(sel.sdt);}else{$(settings.supplyinfoctr).html("");}if(sel.qnt){$(settings.maxprodqtyctr).html("Bu üründen <b>"+sel.qnt+"</b> adet satın alabilirsiniz.");}}else{myWindow.basketContext.productID=0;}};var setSelectedItem=function(uls,l){var filterLis=$("li, option",uls);$(filterLis).each(function(index){var fValue=$(this).attr("value")*1;if(!fValue){return;}if(fValue===selected[l]){$(this).removeClass("selected").addClass("selected");if($(this)[0].tagName==="OPTION"){$(this).parent().val(fValue);}}else{$(this).removeClass("selected");}});};var updateList=function(){var filterUls=$("ul, select",$this);var sel;$(filterUls).each(function(index){var level=$(this).attr("level")*1;if(!level){return;}setSelectedItem(this,level);var selV=selected[level-1];if(selV){var filterLis=$("li",this);if(!sel){sel=settings.filter[selV];}else{sel=sel[selV];}$(filterLis).each(function(index){var fValue=$(this).attr("value");if(!fValue){return;}if(!sel||!sel[fValue]||(sel[fValue].qnt!==undefined&&sel[fValue].qnt===0)){if(selected[level]===fValue){selected[level]=undefined;}$(this).removeClass("finished").addClass("finished");}else{$(this).removeClass("finished");}});}});};var buildList=function(){createList();};var createList=function(){var filterDiv=$this;var i=0;var j=0;var count,v;for(i=1;i<levelcount;i++){var value=settings.level[i];if(value.ui==="Renk"){$(filterDiv).append("<div id='product-colors' class='optbox'><div id='select-color'><select class='product-color-select' id='level"+i+"' level='"+i+"' name='Renk'>");var selectlist=$("#level"+i,filterDiv);count=value.v.length;for(j=0;j<count;j++){v=value.v[j];var colorVal=v.n;$(selectlist).append("<option level='"+i+"' value='"+v.id+"'>"+colorVal+"</option>");}$(selectlist).append("</div>");}else{$(filterDiv).append("<div class='selectBox'><span class='selected'></span><span class='selectArrow'></span><div id='product-size' class='optbox selectOptions'><ul id='level"+i+"' level='"+i+"' class='clearfix'>");var ullist=$("#level"+i,filterDiv);j=0;count=value.v.length;for(j=0;j<count;j++){v=value.v[j];$(ullist).append('<li class="'+v.n.toLowerCase()+'" level="'+i+'" value="'+v.id+'"><a class="selectOption" href="javascript:;">'+v.n+"</a></li>");}$(ullist).append("</ul></div>");}}};var createLightBoxList=function(){var filterDiv=$this;var i=0;var j=0;var count,v;for(i=1;i<levelcount;i++){var value=settings.level[i];if(value.n==="Renk"){$(filterDiv).append("<div id='product-"+value.n+"' class='optbox'><div class='center'><div id='select-color' class='select4'><select id='level"+i+"' level='"+i+"' name='Renk'>");var selectlist=$("#level"+i,filterDiv);j=0;count=value.v.length;for(j=0;j<count;j++){v=value.v[j];$(selectlist).append("<option level='"+i+"' value='"+v.id+"'>"+v.n+"</option>");}$(selectlist).append("</div></div>");}else{$(filterDiv).append("<div id='product-"+value.n+"' class='options clearfix'><ul id='size' level='"+i+"' class='clearfix'>");var ullist=$("#size",filterDiv);j=0;count=value.v.length;for(j=0;j<count;j++){v=value.v[j];$(ullist).append("<li level='"+i+"' value='"+v.id+"'><a href='javascript:;'>"+v.n+"</a></li>");}$(ullist).append("</div></ul>");$("#product-"+value.n,filterDiv).append("<a href='javascript:;' class='body-size'>Beden Ölçüsü</a>");}}};var filterChange=function(control){var pLevel=$(control).attr("level")*1;var pValue=$(control).attr("value")*1;selected[pLevel]=pValue;if(pLevel>=1){var value=settings.level[pLevel].v;var i=0;var count=value.length;for(i=0;i<count;i++){var v=value[i];if(v.id===pValue){var pid=v.pid;if(pLevel===1){if(clientContext.CampID||clientContext.currentCampaign){if(clientContext.currentCampaign){clientContext.CampID=clientContext.currentCampaign;}settings.business.getPrivateProductQuickLookAddToBasketByProductID(pid,clientContext.CampID,settings.addtobasketctr);settings.business.getProductPricesByProductIDAndCampID(pid,clientContext.CampID,settings.pricesctr);}else{settings.business.getProductQuickLookAddToBasketByProductID(pid,settings.addtobasketctr);settings.business.getProductPricesByProductID(pid,settings.pricesctr);}settings.business.getProductPicturesByProductID(pid,settings.picturesctr);}else{if(pLevel===2){if(clientContext.CampID||clientContext.currentCampaign){if(clientContext.currentCampaign){clientContext.CampID=clientContext.currentCampaign;}settings.business.getProductPricesByProductIDAndCampID(pid,clientContext.CampID,settings.pricesctr);}else{settings.business.getProductPricesByProductID(pid,settings.pricesctr);}}}}}}updateList();selectProduct();};buildList();init();$(".productdetail-filteritem li").live("click",function(){filterChange($(this));});$(".productdetail-filteritem select").live("change",function(){filterChange($(".productdetail-filteritem select option:selected"));});};}(window));